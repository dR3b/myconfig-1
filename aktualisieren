#!/bin/bash
#
# Written by Maximilian-Huber.de
#
# Last modified: Wed May 07, 2014  09:38

###############################################################################
# VARIABLES
USER="$(whoami)"
HOST="$(hostname)"
[[ $HOST == "x230" ]] && {
  FOLDER="/home/${USER}/myconfig/"
} || {
  [[ $HOST == "udoo" ]] && {
    FOLDER="/home/${USER}/myconfig/UDOO/"
  } || {
    exit 0
  }
}
ASIMFile="${FOLDER}/asimilieren"
>$ASIMFile

###############################################################################
# FILES
files() {
  [[ $HOST == "x230" ]] && {
    cat <<X230FILES
~/.Xresources
~/.aliasrc
~/.asoundrc.default
~/.asoundrc.hdmi-connected
~/.asoundrc.uca202
~/.bash_profile
~/.bashrc
~/.config/ranger/rc.conf
~/.config/ranger/rifle.conf
~/.emacs
~/.fontconfig/fonts.conf
~/.ghci
~/.gitconfig
~/.inputrc
~/.mutt/colors.solarized-light
~/.ncmpcpp/config
~/.tmux.conf
~/.vimencrypt
~/.vimrc
~/.xinitrc
~/.xmonad/myinformation.sh
~/.xmonad/showkeys
~/.xmonad/tmux-scratch.sh
~/.xmonad/xmobarrc
~/.xmonad/xmonad.hs
~/.zshrc.local
~/bin/disp-controll
~/bin/installiere_neo
~/bin/mailclient.sh
~/bin/mailrun.sh
~/bin/myautosetup.sh
~/bin/mycrypt
~/bin/myfsize.sh
~/bin/myfullbackup.sh
~/bin/mylayouttoggle.sh
~/bin/myPdfCorp.sh
~/bin/myScalaToScript.sh
~/bin/myWmaToMp3.sh
~/bin/ncChat.sh
~/bin/nmgui
~/bin/remove_spaces.sh
~/bin/runNL.sh
/etc/X11/xorg.conf.d/*.conf
/etc/fstab
/etc/hosts
/etc/locale.conf
/etc/lvm/lvm.conf
/etc/mkinitcpio.conf
/etc/modprobe.d/*
/etc/pacman.conf
/etc/sysctl.d/99-sysctl.conf
/etc/vconsole.conf
/etc/vsftpd.conf
/etc/zathurarc
/usr/share/kbd/keymaps/neo/*
X230FILES
  }
  [[ $HOST == "udoo" ]] && {
    cat <<UDOOFILES
~/.config/beets/config.yaml
/etc/mpd.conf
/etc/dnsmasq.conf
/etc/sysctl.d/90-inotify.conf
UDOOFILES
  }
}

###############################################################################
# RUN
echo "copy"
echo
files | while IFS= read -r FILE; do
  [[ ! $FILE == \#* ]] && {
    BASE=${FILE##*/}
    BASE=${BASE#.}
    [[ $BASE == *"*"* ]] && BASE=""
    DIR=""
    [[ $FILE == ~* ]] && {
      FILE=${FILE#\~}
      DIR=${FILE%/*}
      [[ $DIR != "" ]] && {
        DIR=${DIR#*/}"/"
        DIR=${DIR#.}
      }
      FILE="/home/${USER}"${FILE}
    } || {
      DIR=${FILE%/*}
      DIR=${DIR#*/}"/"
      DIR=${DIR#.}
    }

    mkdir -p "${FOLDER}${DIR}"
    cp -vu $FILE "${FOLDER}${DIR}${BASE}"
    git add "${FOLDER}${DIR}${BASE}"

    if [ -f "$FILE"  ]; then
      cmp -s $FILE "${FOLDER}${DIR}${BASE}" > /dev/null
      if [ $? -eq 1 ]; then
        echo "${FILE} is different"
      fi
    fi

    echo "\${FOLDER}${DIR}${BASE} $FILE" >> "$ASIMFile"
  }
done

###############################################################################
# GIT
echo
echo "git"
echo

pushd "$FOLDER"
git commit -a -m "automatisch aktualisiert"
git push
popd
